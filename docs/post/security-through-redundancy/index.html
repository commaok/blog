    <!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="author" content="Josh Bleecher Snyder">
		<meta name="description" content="Words about Go and software">
		<meta name="generator" content="Hugo 0.122.0-DEV">
		<title>Security through intentional redundancy &middot; Don&#39;t Panic</title>
		<link rel="shortcut icon" href="https://commaok.xyz/images/favicon.ico">
		<link rel="stylesheet" href="https://commaok.xyz/css/style.css">
		<link rel="stylesheet" href="https://commaok.xyz/css/highlight.css">
		
		<link rel="stylesheet" href="https://commaok.xyz/css/copy-code.css">
		

		
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
		

		
		<link href="https://commaok.xyz/index.xml" rel="alternate" type="application/rss+xml" title="Don&#39;t Panic" />
		

		<meta property="og:title" content="Security through intentional redundancy" />
<meta property="og:description" content="When writing a service, it&rsquo;s very easy to accidentally forget to check permissions or ownership of an object.
This code has a gaping security hole in it:
func (s *Server) deletePhoto(w http.ResponseWriter, r *http.Request) { id := r.URL.Query().Get(&#34;id&#34;) s.db.DeletePhoto(id) } Anyone who gets ahold of a photo ID can delete that photo.
Developers often address this through middleware, but such middleware tends to get complicated and thus error prone.
The problem is that DeletePhoto API has an insecure design: The caller must actively remember to check permissions before calling it." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://commaok.xyz/post/security-through-redundancy/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2025-09-15T07:12:48-07:00" />
<meta property="article:modified_time" content="2025-09-15T07:12:48-07:00" />


	    <meta itemprop="name" content="Security through intentional redundancy">
<meta itemprop="description" content="When writing a service, it&rsquo;s very easy to accidentally forget to check permissions or ownership of an object.
This code has a gaping security hole in it:
func (s *Server) deletePhoto(w http.ResponseWriter, r *http.Request) { id := r.URL.Query().Get(&#34;id&#34;) s.db.DeletePhoto(id) } Anyone who gets ahold of a photo ID can delete that photo.
Developers often address this through middleware, but such middleware tends to get complicated and thus error prone.
The problem is that DeletePhoto API has an insecure design: The caller must actively remember to check permissions before calling it."><meta itemprop="datePublished" content="2025-09-15T07:12:48-07:00" />
<meta itemprop="dateModified" content="2025-09-15T07:12:48-07:00" />
<meta itemprop="wordCount" content="352">
<meta itemprop="keywords" content="" />
	    <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Security through intentional redundancy"/>
<meta name="twitter:description" content="When writing a service, it&rsquo;s very easy to accidentally forget to check permissions or ownership of an object.
This code has a gaping security hole in it:
func (s *Server) deletePhoto(w http.ResponseWriter, r *http.Request) { id := r.URL.Query().Get(&#34;id&#34;) s.db.DeletePhoto(id) } Anyone who gets ahold of a photo ID can delete that photo.
Developers often address this through middleware, but such middleware tends to get complicated and thus error prone.
The problem is that DeletePhoto API has an insecure design: The caller must actively remember to check permissions before calling it."/>

	</head>

    <body>
       <nav class="main-nav">
	
	
		<a href='https://commaok.xyz/'>Home</a>
	
	

	
	
		<a class="cta" href="https://commaok.xyz/index.xml">RSS</a>
	
	
</nav>

        <section id="wrapper">
            <article class="post">
                <header>
                    <h1>Security through intentional redundancy</h1>
                    <h2 class="headline">
                    September 15, 2025 
                    <br>
                    
                    </h2>
                </header>
                <section id="post-body">
                    <p>When writing a service, it&rsquo;s very easy to accidentally forget to check permissions or ownership of an object.</p>
<p>This code has a gaping security hole in it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Server</span>) <span style="color:#a6e22e">deletePhoto</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">id</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">Query</span>().<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;id&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">DeletePhoto</span>(<span style="color:#a6e22e">id</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><em>Anyone</em> who gets ahold of a photo ID can delete that photo.</p>
<p>Developers often address this through middleware, but such middleware tends to get complicated and thus error prone.</p>
<p>The problem is that <code>DeletePhoto</code> API has an insecure design: The caller must actively remember to check permissions before calling it. It fails open.</p>
<p>One approach to fixing this is to add redundant arguments.</p>
<p>Let&rsquo;s change:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">DB</span>) <span style="color:#a6e22e">DeletePhoto</span>(<span style="color:#a6e22e">id</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">error</span>
</span></span></code></pre></div><p>to this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">DB</span>) <span style="color:#a6e22e">DeletePhoto</span>(<span style="color:#a6e22e">id</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">owner</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>) <span style="color:#66d9ef">error</span>
</span></span></code></pre></div><p>The owner parameter is, strictly speaking, redundant. The photo ID already uniquely identifies its owner.</p>
<p>But now, the caller needs a <code>*User</code> to use the API. They&rsquo;ll probably reach for the most convenient one.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Server</span>) <span style="color:#a6e22e">deletePhoto</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">id</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">Query</span>().<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;id&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// grab user set by middleware
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">user</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Context</span>().<span style="color:#a6e22e">Value</span>(<span style="color:#e6db74">&#34;user&#34;</span>).(<span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">DeletePhoto</span>(<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">user</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This is the path of lowest resistance to calling <code>DeletePhoto</code>. A developer (or an LLM) might write this code without thinking about security at all&hellip;and yet, it&rsquo;s pretty solid, because <code>DeletePhoto</code> can enforce that the photo must be owned by the provided user. Only one person (the author of <code>DeletePhoto</code>) had to think about security. Everyone else gets it for free. This API fails closed.</p>
<p>This approach works across many programming languages, and at many different API levels.</p>
<p>My favorite is SQL, usually via <a href="https://sqlc.dev/">sqlc</a>. For example, change the query from:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">FROM</span> photos <span style="color:#66d9ef">WHERE</span> id <span style="color:#f92672">=</span> <span style="color:#f92672">?</span>;
</span></span></code></pre></div><p>to:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">FROM</span> photos <span style="color:#66d9ef">WHERE</span> id <span style="color:#f92672">=</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">and</span> owner_id <span style="color:#f92672">=</span> <span style="color:#f92672">?</span>;
</span></span></code></pre></div><p>The main challenge I&rsquo;ve encountered with this in the past is that people will want to refactor the code to remove the clutter. It can take some convincing.</p>
<p>This trick isn&rsquo;t a panacea (nothing is), but it definitely helps. And in an era in which serious amounts of code is being written by LLMs, with only local information, secure-by-default APIs look increasingly appealing.</p>

                </section>
            </article>
            <footer id="post-meta" class="clearfix">
                
                        <img class="avatar" src="https://commaok.xyz/images/avatar.png">
                        <div>
                            <span class="dark">Josh Bleecher Snyder</span>
                            <span>It&#39;s me.</span>
                        </div>
                    
            </footer>

            

            <ul id="post-list" class="archive readmore">
    <h3>Read more</h3>

    
    
        
    
    
    
    
        
        <li>
            <a href="https://commaok.xyz/post/audio-only/">Why I leave my webcam off<aside class="dates">Jan 5</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/connections/">How to make NYT Connections better<aside class="dates">Oct 27</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/security-through-redundancy/">Security through intentional redundancy<aside class="dates">Sep 15</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/simple-backoff/">Simpler backoff<aside class="dates">May 30</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/blog-schism/">Blog schism<aside class="dates">May 23</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/podcast/">Podcast ho!<aside class="dates">Jan 12</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/on_hugo/">Sometimes Software is Done, or Why Hugo Why<aside class="dates">Jan 9</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/type_specialization/">Type Specialization in Go<aside class="dates">Apr 3</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/tstruct/">Nicer struct literals in Go templates<aside class="dates">Jun 24</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/perf_files/">Performance and files full of code<aside class="dates">Apr 30</aside></a>
        </li>
        
   
</ul>
            <footer id="footer">
    
        <div id="social">

	
	
    <a class="symbol" href="https://www.github.com/josharian">
        <i class="fa fa-github"></i>
    </a>
    


</div>

    
    <p class="small">
    
        Â© Copyright 2026 Josh Bleecher Snyder
    
    </p>
</footer>

        </section>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://commaok.xyz/js/main.js"></script>
<script src="https://commaok.xyz/js/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script src="https://commaok.xyz/js/copy-code.js"></script>




    </body>
</html>