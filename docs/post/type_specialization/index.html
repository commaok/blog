    <!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="author" content="Josh Bleecher Snyder">
		<meta name="description" content="Words about Go">
		<meta name="generator" content="Hugo 0.111.3">
		<title> &middot; Don&#39;t Panic</title>
		<link rel="shortcut icon" href="https://commaok.xyz/images/favicon.ico">
		<link rel="stylesheet" href="https://commaok.xyz/css/style.css">
		<link rel="stylesheet" href="https://commaok.xyz/css/highlight.css">
		

		
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
		

		
		<link href="https://commaok.xyz/index.xml" rel="alternate" type="application/rss+xml" title="Don&#39;t Panic" />
		

		<meta property="og:title" content="" />
<meta property="og:description" content="Type Specialization in Go
Basic devirt
Complicated devirt
type Gopher interface { Goph() }
func f(x Gopher) { // … if t, ok := x.(*T); ok { t.Goph() } else { x.Goph() } // … }
Why would you write code with a pointless type assertion like this?
This is type specialization, a common optimization done by JIT compilers. The type assertion is really cheap, and when it succeeds, it can improve escape analysis (allocs less) and allow inlining (faster)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://commaok.xyz/post/type_specialization/" /><meta property="article:section" content="post" />



	    <meta itemprop="name" content="">
<meta itemprop="description" content="Type Specialization in Go
Basic devirt
Complicated devirt
type Gopher interface { Goph() }
func f(x Gopher) { // … if t, ok := x.(*T); ok { t.Goph() } else { x.Goph() } // … }
Why would you write code with a pointless type assertion like this?
This is type specialization, a common optimization done by JIT compilers. The type assertion is really cheap, and when it succeeds, it can improve escape analysis (allocs less) and allow inlining (faster).">

<meta itemprop="wordCount" content="145">
<meta itemprop="keywords" content="" />
	    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Type Specialization in Go
Basic devirt
Complicated devirt
type Gopher interface { Goph() }
func f(x Gopher) { // … if t, ok := x.(*T); ok { t.Goph() } else { x.Goph() } // … }
Why would you write code with a pointless type assertion like this?
This is type specialization, a common optimization done by JIT compilers. The type assertion is really cheap, and when it succeeds, it can improve escape analysis (allocs less) and allow inlining (faster)."/>
<meta name="twitter:site" content="@https://www.twitter.com/commaok"/>

	</head>

    <body>
       <nav class="main-nav">
	
	
		<a href='https://commaok.xyz/'>Home</a>
	

	
	<a class="cta" href="https://commaok.xyz/index.xml">RSS</a>
	
</nav>


        <section id="wrapper">
            <article class="post">
                <header>
                    <h1></h1>
                    <h2 class="headline">
                    January 1, 0001 
                    <br>
                    
                    </h2>
                </header>
                <section id="post-body">
                    <p>Type Specialization in Go</p>
<p>Basic devirt</p>
<p>Complicated devirt</p>
<p>type Gopher interface {
Goph()
}</p>
<p>func f(x Gopher) {
// …
if t, ok := x.(*T); ok {
t.Goph()
} else {
x.Goph()
}
// …
}</p>
<p>Why would you write code with a pointless type assertion like this?</p>
<p>This is type specialization, a common optimization done by JIT compilers. The type assertion is really cheap, and when it succeeds, it can improve escape analysis (allocs less) and allow inlining (faster).</p>
<p>But it definitely reduces readability, so use only when it counts, and document it.</p>
<p>Why doesn’t the compiler do this for you? It doesn’t know what types would be good to try. JIT could help. FGO could help. LTO could help. None of those are available, so it is left to programmers.</p>
<p>This post was originally <a href="https://twitter.com/commaok/status/1406650785740451842">a tweet</a>, but it kept coming up in discussion.</p>

                </section>
            </article>
            <footer id="post-meta" class="clearfix">
                <a href="https://twitter.com/commaok">
                        <img class="avatar" src="https://commaok.xyz/images/avatar.png">
                        <div>
                            <span class="dark">Josh Bleecher Snyder</span>
                            <span>righthandgreen.com</span>
                        </div>
                    </a>
            </footer>

            

            <ul id="post-list" class="archive readmore">
    <h3>Read more</h3>

    
    
    
        
        <li>
            <a href="https://commaok.xyz/post/tstruct/">Nicer struct literals in Go templates<aside class="dates">Jun 24</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/perf_files/">Performance and files full of code<aside class="dates">Apr 30</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/test-beta/">How to test a Go beta or RC<aside class="dates">Jun 13</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/lookup_tables/">Make your lookup table do more<aside class="dates">Jun 3</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/riscv_isa_blog_post/">What happens when you load into x0 on RISC-V?<aside class="dates">Feb 17</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/fork-point/">git rebase --fork-point considered harmful (by me)<aside class="dates">Nov 2</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/safer-generated-code/">Generating safer Go code<aside class="dates">Oct 28</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/discovering-size-classes/">Discovering alloc size classes in Go<aside class="dates">Sep 1</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/no-line-numbers/">Life without line numbers<aside class="dates">Apr 30</aside></a>
        </li>
        
   
    
        
        <li>
            <a href="https://commaok.xyz/post/intern-strings/">Interning strings in Go<aside class="dates">Dec 17</aside></a>
        </li>
        
   
</ul>

            <footer id="footer">
    
        <div id="social">

	
	
    <a class="symbol" href="https://www.github.com/josharian">
        <i class="fa fa-github"></i>
    </a>
    
    <a class="symbol" href="https://www.twitter.com/commaok">
        <i class="fa fa-twitter"></i>
    </a>
    


</div>

    
    <p class="small">
    
        © Copyright 2023 Josh Bleecher Snyder
    
    </p>
</footer>

        </section>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://commaok.xyz/js/main.js"></script>
<script src="https://commaok.xyz/js/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>





    </body>
</html>
